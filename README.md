# 天池双高疾病风险预测

#### **一、数据介绍**

训练集：38150

测试集：9532

特征：体检特征，包含数字，中文，特殊字符等非结构化特征

预测五项指标：收缩压，舒张压，甘油三酯，高密度脂蛋白胆固醇和低密度脂蛋白胆固醇。



#### **二、数据清洗**

**1.特征划分和粗略清洗**

①划分特征：使用**正则表达式**（特征中是否包含数字）将特征分为数值特征和中文特征

②去除缺失值过多的特征：去除缺失值比例高达99%的数值特征，缺失值比例啊高达98%的中文特征

③去除y值不规范的样本点：训练集中的y是“未查”之类的中文和“>”,"<"类的，共去除49个样本点

**2.数值特征清洗**

①规范的数值特征：直接转为float型。

②包含中文或特殊字符的数值特征：使用正则表达式提取出数字，若存在多个描述该检查项目的数字，则取平均。

③存在正常范围的数值特征：根据提供的正常范围进行映射，但保持原来的顺序，比如”心率“特征，根据快慢正常，映射为1,2,3，缺失认为是正常。

④去除不重要的数值特征：比如缺失值过多且未缺失中包含数字很少的特征

**3.中文特征清洗**

①中文特征只挑选了部分比较重要的特征进行单个的处理，当**枚举类型**处理，再进行**one-hot编码**，缺失按照一类进行编码

②对于部分枚举类不会互斥的特征，不能使用one-hot编码，比如：”病史“列，样本既可能有高血压史，也可能有糖尿病史，所以得构造高血压史和糖尿病史列进行分别计数。

③中文特征组合。存在多个中文特征描述一种器官的情况，可以进行特征的融合。比如病史有0434和0409这两列，则可以合并，只有两列都说正常才认为是正常，有一列说是糖尿病，则认为其患有糖尿病。

④阴性和阳性的特征。阴性认为是正常的，阳性认为是异常的，并根据阳性+个数的多少作为值。

补充：复赛中的基因特征是枚举类型，缺失算一类，直接one-hot编码。



#### 三、预处理

**1.异常点的去除**

①5项指标异常点去除：去除认为5项指标中错误的点，比如收缩压为0或者上万的样本的。

②重要特征中异常点去除：根据xgb的feature_importance的排名选出的重要特征，画出各个重要特征与y的散点图，去除离群点。

**2.缺失值填充**

初赛中未进行处理，因为xgb和lgb模型本身可以处理缺失值。

复赛按均值进行填充（处理的可能不好，比如有些特征的分布存在偏移）

**3.归一化**

初赛中树模型无需归一化处理。

复赛中进行了MinMAX的归一化处理。

**4.特征选择**

初赛未进行特征选择，因为xgb和lgb模型本身具有特征选择的功能

复赛是使用f_regression进行的特征选择

**5.特征组合**

只在复赛中进行，由于是脱敏特征，无法人工进行特征组合，尝试盲目组合的方式。

①基因数据，采用两两相乘的方式取交集。

②数值特征，采用两两+-*的方式。

最后根据gbdt的feature_impoetance取得分不为0的特征。



#### 四、模型融合

初赛中使用xgb和lgb两个模型，加权平均的方式进行模型融合。没时间尝试stacking。

复赛中由于平台限制，使用单模型gbdt。



#### 五、代码说明

data_cleaning.py：特征划分和粗略清洗

data_cleaning_num.py：数值特征处理

data_cleaning_ch.py：中文特征处理

data_combine.py：数值特征和中文特征的合并

denosing.py：异常点去除

runModel.py：模型构建和融合

stacking.py : stacking融合

main.py ：代码运行主程序



#### 六、经验教训

初赛排名：44

复赛排名：51

①客观原因：平台垃圾，数据量少，缺失值多。

②主观原因：不会做特征工程，缺乏经验，比赛过程中有所懈怠。

③画图分析数据很重要。比如：本比赛中训练集y的分布有偏倚，通过进行log变化使其符合正态分布，有提高成绩。同时还可以观察最后预测结果的分布，看与训练集中的y的分布是否相似，能够评判预测的好坏。

④通过观察错误预测的样本的特征来调整原始特征的提取比盲目的进行特征提取要更有针对性。

本次比赛主要是一个小数据量高维度的预测问题，初赛比较简单地进入了复赛，没有做特征工程。做复赛发现成绩进步非常难，时间也是不够的。建议就是，特征工程尽可能地在复赛做完，到复赛只要还原这些特征就可以了，然后再对新增的特征进行分析，这样时间比较充足。